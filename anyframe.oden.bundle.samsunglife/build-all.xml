<project name="_Oden Full SamsungLife" default="build.all.dbg" basedir=".">
	<property name="version" value="1.2.0"/>
	<property name="oden.fwk" location="../anyframe.oden.bundle"/>
	<target name="build.all">
		<condition property="todo" else="all-local">
			<isset property="todo"/>
		</condition>
		<ant antfile="../anyframe.oden.bundle/build.xml" target="${todo}" inheritall="false" />
			
		<ant antfile="../anyframe.common.bundle.gate/build.xml" target="${todo}" inheritall="false" />

		<ant antfile="../anyframe.oden.bundle.common/build.xml" target="${todo}" inheritall="false" />
				
		<ant antfile="../anyframe.oden.bundle.core/build.xml" target="${todo}" inheritall="false" />

		<ant antfile="../anyframe.oden.bundle.hessiancli/build.xml" target="${todo}" inheritall="false" />
				
		<ant antfile="../anyframe.oden.bundle.hessiansvr/build.xml" target="${todo}" inheritall="false" />
		
		<ant antfile="../anyframe.oden.bundle.ent.misc/build.xml" target="${todo}" inheritall="false" />

		<ant antfile="../anyframe.oden.bundle.ent.repository/build.xml" target="${todo}" inheritall="false" />

		<ant antfile="../anyframe.oden.bundle.ent.snapshot/build.xml" target="${todo}" inheritall="false" />

		<ant antfile="../anyframe.oden.bundle.ent.http/build.xml" target="${todo}" inheritall="false" />
		
		<ant antfile="../anyframe.oden.bundle.ent.auth/build.xml" target="${todo}" inheritall="false" />
		
		<ant antfile="../anyframe.oden.bundle.samsunglife/build.xml" target="${todo}" inheritall="false" />
	</target>
	
	<target name="build.all.dbg">
		<property name="todo" value="all.dbg" />
		<antcall target="build.all" />
	</target>
	
	<target name="pack.agent" depends="build.all" description="package oden agent">
		<delete dir="${basedir}/pack" excludes="*.tar.gz"/>
		<mkdir dir="${basedir}/pack/bin"/>
		<mkdir dir="${basedir}/pack/bundle"/>
		
		<copy todir="${basedir}/pack/bin">
			<fileset dir="${oden.fwk}/dist" includes="oden-*.jar"/>
		</copy>
		<copy todir="${basedir}/pack/bundle">
			<fileset dir="${oden.fwk}/bundle" 
				includes=
					"anyframe.oden.bundle.hessiansvr-*.jar,
					anyframe.oden.bundle.common-*.jar,
					org.apache.felix.configadmin-*.jar,
					org.apache.felix.eventadmin-*.jar,
					org.apache.felix.http.jetty-*.jar,
					org.apache.felix.log-*.jar,
					org.apache.felix.scr-*.jar,
					hessian-*.jar,
					felix*.jar"/>
		</copy>
		<copy todir="${basedir}/pack">
			<fileset dir="rscs" includes="startup-agent.sh,shutdown.sh,startup.cmd"/>
		</copy>
		<rename src="pack/startup-agent.sh" dest="pack/startup.sh"/>
		
		<tar destfile="${basedir}/pack/oden-agent-${version}.tar">
			<tarfileset dir="pack" includes="*.sh" filemode="755" />
			<tarfileset dir="pack" includes="bin/**,bundle/**"/>
		</tar>
		<gzip destfile="${basedir}/pack/oden-agent-${version}.tar.gz" src="${basedir}/pack/oden-agent-${version}.tar"/>
		<delete file="${basedir}/pack/oden-agent-${version}.tar"/>
	</target>
			
	<target name="pack.server" depends="build.all" description="package oden">
		<delete dir="${basedir}/pack" excludes="*.tar.gz"/>	
		<mkdir dir="${basedir}/pack/bin"/>
		<mkdir dir="${basedir}/pack/bundle"/>
		<mkdir dir="${basedir}/pack/conf"/>
		
		<copy todir="${basedir}/pack/bin">
			<fileset dir="${oden.fwk}/dist" includes="oden-*.jar"/>
		</copy>
		<copy todir="${basedir}/pack/bundle">
			<fileset dir="${oden.fwk}/bundle" 
				includes="anyframe.common.bundle.gate-*.jar,
					anyframe.oden.bundle.common-*.jar,
					anyframe.oden.bundle.core-*.jar,
					anyframe.oden.bundle.hessiancli-*.jar,
					anyframe.oden.bundle.samsunglife-*.jar,
					anyframe.oden.bundle.ent.misc-*.jar,
					anyframe.oden.bundle.ent.repository-*.jar,
					anyframe.oden.bundle.ent.snapshot-*.jar,
					anyframe.oden.bundle.ent.http-*.jar,
					anyframe.oden.bundle.ent.auth-*.jar,
					felix.jar,
					org.apache.felix.configadmin-*.jar,
					org.apache.felix.eventadmin-*.jar,
					org.apache.felix.http.jetty-*.jar,
					org.apache.felix.log-*.jar,
					org.apache.felix.prefs-*.jar,
					org.apache.felix.scr-*.jar,
					org.apache.felix.shell.remote-*.jar,
					org.json_*.jar,
					hessian-*.jar,
					jdom.jar,
					xerces-*.jar" />
		</copy>
		<copy todir="${basedir}/pack/conf">
			<fileset dir="rscs" includes="oden.ini"/>
		</copy>
		<copy todir="${basedir}/pack">
			<fileset dir="rscs" includes="startup.sh,shutdown.sh,runc.sh,acc.sh"/>
		</copy>
		
		<tar destfile="${basedir}/pack/oden-${version}.tar">
			<tarfileset dir="pack" includes="*.sh" filemode="755" />
			<tarfileset dir="pack" includes="bin/**,bundle/**,conf/**"/>
		</tar>
		<gzip destfile="${basedir}/pack/oden-${version}.tar.gz" src="${basedir}/pack/oden-${version}.tar"/>
		<delete file="${basedir}/pack/oden-${version}.tar"/>
	</target>
</project>